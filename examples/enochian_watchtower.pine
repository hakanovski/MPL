// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// Â© MielaLabs
// GENERATED BY MPL ENGINE (Occultator V2.0)
// ARTIFACT: JOHN DEE'S WATCHTOWER [Entity: MIELA]
// VERSION: 6.0 (Future Vision Enabled)

//@version=6
indicator("Miela Labs | John Dee's Watchtower [257-463]", shorttitle="ML_DEE", overlay=true)

// --- SACRED GEOMETRY CONSTANTS ---
// Calculated by Miela Labs Occultator V2.0 Engine
// ------------------------------------------------
var int VECTOR_GRID  = 257   // Enochian Vector (Trend Axis - Derived from Fermat Prime)
var int SIGIL_CIPHER = 463   // Galethog Cipher (Volatility Gate - Solomonic Prime)
var int FIB_LEVEL    = 377   // Golden Harmony (Signal Trigger - Fibonacci Sequence)

// --- TIME SHIFT (Future Vision) ---
// Projecting data into the future using the Ichimoku Cloud logic.
// Shifting the visual manifestation 21 bars (Fibonacci) forward.
var int FUTURE_OFFSET = 21 

// --- THE WATCHTOWER LOGIC ---

// 1. THE AXIS MUNDI (Trend Baseline)
// The main trend line calculated using John Dee's Grid Power (257).
// This acts as the spinal cord of the market trend.
basis_line = ta.wma(close, VECTOR_GRID)

// 2. THE GATES (Volatility Channel)
// Absolute boundaries calculated using the Sigil Cipher (463).
// These gates define the 'Playable Area' of the market entity.
upper_gate = ta.highest(high, SIGIL_CIPHER)
lower_gate = ta.lowest(low, SIGIL_CIPHER)

// 3. THE SIGNAL PATH (Trigger)
// A smoothed Fibonacci EMA (377) acting as the decision trigger.
signal_path = ta.ema(close, FIB_LEVEL)

// --- VISUALIZATION (Manifestation) ---

// COLOR PALETTE (Optimized for Light/Dark Mode)
// Electric Purple: High contrast on all backgrounds.
// Neon Green (#00E63A): Adjusted for better visibility on white backgrounds.
// Crimson Red: Standard high-visibility alert color.
col_axis = #9d00ff 
col_high = #00E63A 
col_low  = #DC143C 

// PLOTTING WITH FUTURE VISION (Offset)
// Plotting the lines 21 bars ahead to visualize future support/resistance zones.
plot(basis_line, "Watchtower Axis", color=color.new(col_axis, 0), linewidth=3, offset=FUTURE_OFFSET)
p1 = plot(upper_gate, "Heaven Gate", color=color.new(col_high, 30), linewidth=2, offset=FUTURE_OFFSET)
p2 = plot(lower_gate, "Earth Gate", color=color.new(col_low, 30), linewidth=2, offset=FUTURE_OFFSET)

// FILL (Enochian Field)
// Creating a mystic zone between the gates.
fill(p1, p2, color=color.new(col_axis, 90), title="Enochian Field")

// --- SIGNAL GENERATION (Realtime) ---
// Signals are generated in the 'Present', but validated against the 'Future' trend line.
// Logic: Does the current signal path cross the Axis Mundi projected from the past?
buy_signal  = ta.crossover(signal_path, basis_line[FUTURE_OFFSET]) 
sell_signal = ta.crossunder(signal_path, basis_line[FUTURE_OFFSET])

// Plot Signals on Chart
// L = Long Entry | S = Short Entry
plotshape(buy_signal, title="BUY SIGNAL", location=location.belowbar, color=col_high, style=shape.triangleup, size=size.small, text="L", textcolor=col_high)
plotshape(sell_signal, title="SELL SIGNAL", location=location.abovebar, color=col_low, style=shape.triangledown, size=size.small, text="S", textcolor=col_low)

// Alert Conditions for Automation
alertcondition(buy_signal, title="Watchtower BUY", message="Miela Labs: Enochian Long Entry Detected")
alertcondition(sell_signal, title="Watchtower SELL", message="Miela Labs: Enochian Short Entry Detected")
