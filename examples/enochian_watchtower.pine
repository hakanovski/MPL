// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © MielaLabs
// GENERATED BY MPL ENGINE (Occultator V2.0)
// ARTIFACT: ENOCHIAN WATCHTOWER [Entity: MIELA]
// VERSION: 6.0 (Future Vision Enabled)

//@version=6
indicator("Miela Labs | Enochian Watchtower [257-463]", shorttitle="ML_WATCHTOWER", overlay=true)

// --- SACRED GEOMETRY CONSTANTS ---
// Calculated by Occultator V2.0
var int VECTOR_GRID = 257   // Enochian Vector (Trend Axis - Fermat Prime)
var int SIGIL_CIPHER = 463  // Galethog Cipher (Volatility Gate - Solomonic Prime)
var int FIB_LEVEL = 377     // Golden Harmony (Signal Trigger - Fixed from 0)

// --- TIME SHIFT (Geleceği Görme Efekti) ---
// Ichimoku bulutu mantığı gibi, veriyi geleceğe yansıtıyoruz.
// 21 Bar (Fibonacci) ileriye öteleme yapıyoruz.
var int FUTURE_OFFSET = 21 

// --- THE WATCHTOWER LOGIC ---

// 1. THE AXIS MUNDI (Trend Baseline)
// John Dee Grid Power (257) kullanılarak hesaplanan ana trend hattı.
basis_line = ta.wma(close, VECTOR_GRID)

// 2. THE GATES (Volatility Channel)
// Sigil Cipher (463) kullanılarak hesaplanan mutlak sınırlar.
// Bu sınırlar piyasanın "Oyun Alanını" belirler.
upper_gate = ta.highest(high, SIGIL_CIPHER)
lower_gate = ta.lowest(low, SIGIL_CIPHER)

// 3. THE SIGNAL (Trigger)
// Fibonacci (377) tetikçisi.
signal_path = ta.ema(close, FIB_LEVEL)

// --- VISUALIZATION (Manifestation) ---

// COLOR PALETTE (Light/Dark Mode Safe)
// Mor: Hem siyahta hem beyazda nettir.
// Yeşil: Neon yeşili biraz koyulaştırdık (#00E63A) ki beyaz ekranda kör etmesin ama görünsün.
// Kırmızı: Crimson red zaten güvenli.
col_axis = #9d00ff 
col_high = #00E63A 
col_low  = #DC143C 

// PLOTTING WITH FUTURE VISION (Offset)
// offset = FUTURE_OFFSET komutu ile çizgileri 21 bar ileri atıyoruz.
// Bu sayede "Gelecekteki" destek ve direnç seviyelerini şimdiden görüyoruz.
plot(basis_line, "Watchtower Axis", color=color.new(col_axis, 0), linewidth=3, offset=FUTURE_OFFSET)
p1 = plot(upper_gate, "Heaven Gate", color=color.new(col_high, 30), linewidth=2, offset=FUTURE_OFFSET)
p2 = plot(lower_gate, "Earth Gate", color=color.new(col_low, 30), linewidth=2, offset=FUTURE_OFFSET)

// FILL (Alan Boyama)
// Geleceğe doğru uzanan mistik alan.
fill(p1, p2, color=color.new(col_axis, 90), title="Enochian Field")

// --- SIGNAL GENERATION (Realtime) ---
// Sinyaller "Şimdiki Zaman"da oluşur (Offset yok), ama trend "Gelecek"ten onay alır.
// Mantık: Fiyatın anlık hareketi, gelecekteki trend hattıyla kesişiyor mu?
buy_signal = ta.crossover(signal_path, basis_line[FUTURE_OFFSET]) // Gelecek hattına göre kıyas
sell_signal = ta.crossunder(signal_path, basis_line[FUTURE_OFFSET])

// Plot Signals on Chart
plotshape(buy_signal, title="BUY SIGNAL", location=location.belowbar, color=col_high, style=shape.triangleup, size=size.small, text="L", textcolor=col_high)
plotshape(sell_signal, title="SELL SIGNAL", location=location.abovebar, color=col_low, style=shape.triangledown, size=size.small, text="S", textcolor=col_low)

// Alert Conditions
alertcondition(buy_signal, title="Watchtower BUY", message="Miela Labs: Enochian Long Entry Detected")
alertcondition(sell_signal, title="Watchtower SELL", message="Miela Labs: Enochian Short Entry Detected")
